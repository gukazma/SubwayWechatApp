# 地铁微信小程序 - 前后端交互示例

这是一个使用 uni-app 开发的地铁微信小程序，包含完整的前后端交互功能。

## 项目结构

```
SubwayWechatApp/
├── src/                    # 前端源码
│   ├── pages/
│   │   └── index/
│   │       └── index.vue  # 主页面（包含API测试界面）
│   ├── App.vue            # 应用入口
│   ├── main.js
│   ├── pages.json         # 页面配置
│   └── manifest.json      # 应用配置
├── server/                # 后端源码
│   ├── index.js           # Express 服务器
│   └── package.json
├── dist/                  # 编译输出目录
│   └── dev/
│       └── mp-weixin/     # 微信小程序编译文件
└── package.json           # 前端依赖配置
```

## 功能特性

### 后端 API（Express + Node.js）

后端服务器运行在 `http://localhost:3000`，提供以下接口：

1. **测试接口**
   - `GET /api/test` - 测试服务器连接状态

2. **地铁线路管理**
   - `GET /api/subway/lines` - 获取所有地铁线路
   - `GET /api/subway/lines/:id` - 获取单条线路详情

3. **收藏功能**
   - `POST /api/favorites` - 添加收藏
   - `GET /api/favorites/:userId` - 获取用户收藏列表
   - `DELETE /api/favorites/:id` - 删除收藏

### 前端界面（uni-app + Vue3）

前端提供了一个完整的测试界面，包含：

- **服务器连接测试** - 测试前后端连接是否正常
- **地铁线路列表** - 展示所有地铁线路（带颜色标识）
- **收藏功能** - 可以收藏喜欢的线路
- **收藏管理** - 查看和删除已收藏的线路

## 快速开始

### 1. 启动后端服务器

打开终端，执行：

\`\`\`bash
cd server
npm start
\`\`\`

你应该看到：
\`\`\`
🚇 地铁微信小程序后端服务已启动
📍 服务地址: http://localhost:3000
\`\`\`

### 2. 启动前端开发服务器

前端已经在运行中（如果没有运行，请执行）：

\`\`\`bash
npm run dev:mp-weixin
\`\`\`

### 3. 在微信开发者工具中打开

1. 打开**微信开发者工具**
2. 导入项目，选择目录：`dist/dev/mp-weixin`
3. AppID 使用测试号或您自己的 AppID

### 4. 测试前后端交互

在微信开发者工具中：

1. 点击"**测试服务器连接**"按钮
   - 如果成功，会显示绿色提示
   - 如果失败，请确保后端服务已启动

2. 点击"**获取地铁线路列表**"
   - 会显示 4 条地铁线路信息
   - 每条线路有不同的颜色标识

3. 测试收藏功能
   - 点击任意线路的"收藏"按钮
   - 点击"查看我的收藏"查看收藏列表
   - 点击"删除"移除收藏

## 技术栈

### 前端
- **uni-app** - 跨平台开发框架
- **Vue 3** - 渐进式 JavaScript 框架
- **Vite** - 新一代前端构建工具

### 后端
- **Node.js** - JavaScript 运行环境
- **Express** - Web 应用框架
- **CORS** - 跨域资源共享中间件

## 开发说明

### 修改后端代码

1. 编辑 `server/index.js`
2. 保存后自动重启服务器（使用 nodemon）
3. 无需手动重启

### 修改前端代码

1. 编辑 `src/pages/index/index.vue`
2. 保存后自动重新编译
3. 在微信开发者工具中刷新即可看到变化

### API 数据格式

所有接口返回统一格式：

\`\`\`json
{
  "code": 200,
  "message": "成功",
  "data": { ... }
}
\`\`\`

## 注意事项

1. **开发环境配置**
   - manifest.json 中已设置 `"urlCheck": false`，允许访问本地服务器
   - 生产环境需要配置合法域名

2. **端口冲突**
   - 如果 3000 端口被占用，请修改 `server/index.js` 中的 PORT 变量
   - 同时修改前端 `src/pages/index/index.vue` 中的 baseURL

3. **跨域问题**
   - 后端已配置 CORS，允许跨域请求
   - 微信小程序需要在项目设置中关闭域名校验（仅开发时）

## 下一步开发建议

1. 添加数据库（如 MongoDB、MySQL）
2. 实现用户登录认证
3. 添加更多地铁线路和站点信息
4. 实现路线查询功能
5. 添加地图显示
6. 实现实时车辆位置跟踪

## 问题排查

### 连接失败
- 确认后端服务是否已启动
- 检查端口是否正确（默认 3000）
- 检查微信开发者工具是否关闭了"不校验合法域名"

### 编译错误
- 删除 `node_modules` 后重新 `npm install`
- 确认 Node.js 版本 >= 14.0

## 许可证

MIT
